#+TITLE: Flex & Bison
#+AUTHOR: John Levin
#+DATE: 2009
#+EMAIL: evan@mantle.co
#+CREATOR: Evan Nagle
#+TAGS: @c @linux @flex @bison

* Introduction
** Lexing = scanning = parsing text into tokens
** Parsing = determines **relationship** amongst tokens
   Converts stream of tokens into a tree of tokens.
** Structure of a Lex/Bison file:   

%{
//PROLOGUE in C
#include <stdio.h>
#define BRITNEY "spears"
%}

%%

Grammar Rules

%%

Epilogue

int main(int argc, char **argv) {
  printf("%s\n", "here we go!");
  yylex(); ==> runs the lexer
  return 0;
}

** Simple Flex Makefile

#+BEGIN_SRC Makefile
APP       = app
APP_L     = $(APP).l
LC        = flex
LFLAGS    = 
CC        = gcc
CFLAGS    =

all: $(APP)

# lex.yy.c is the file outputted by Flex
# running flex app.l
lex.yy.c: $(APP_L)
    $(LC) $(LFLAGS) $(APP_L)

# running gcc -o app lex.yy.c
$(APP): lex.yy.c
    $(CC) $(CFLAGS) -o $(APP) lex.yy.c

#+END_SRC
** Sample: wc

#+BEGIN_SRC sh
echo "here I am" | ./data/wc/wc
#+END_SRC

#+RESULTS:
| chars: | 10 |
| words: |  3 |
| lines: |  1 |


** Sample: colour

#+BEGIN_SRC sh
echo "What colour is this?" | ./data/colour/colour
#+END_SRC

#+RESULTS:
: What color is this?

** Sample: dumber

#+BEGIN_SRC sh :results scalar
echo "1 + 2 * 10 / 5x" | ./data/dumbers/dumbers
#+END_SRC

#+RESULTS:
: NUMBER 1
: PLUS
: NUMBER 2
: TIMES
: NUMBER 10
: DIVIDE
: NUMBER 5
: MYSTERY CHAR x
: NEWLINE

** Sample: number lexer

#+BEGIN_SRC sh
echo "1 * 24 - 14" | ./data/number-scanner/number-scanner
#+END_SRC

#+RESULTS:
| 258 |  1 |
| 261 |    |
| 258 | 24 |
| 260 |    |
| 258 | 14 |
| 264 |    |

* Bison and Flex Together
** In flex.l file  
*** remove enum yytokentype
*** also remove int yylval
*** also remove the int main() call   
*** import flex.tab.h, which is generated by bison   
** Sample: calculator

#+BEGIN_SRC sh
echo "10 - 5" | ./data/calculator/calculator
echo "10 + 5" | ./data/calculator/calculator
echo "5 * 5" | ./data/calculator/calculator
echo "15 / 3 * 2" | ./data/calculator/calculator
#+END_SRC

#+RESULTS:
| = |  5 |
| = | 15 |
| = | 25 |
| = | 10 |

** Sample: calculator with parens and comments

#+BEGIN_SRC sh
./data/calculator-p/calculator <<<'5 * (5 + 1) //should be thirty'
#+END_SRC

#+RESULTS:
: = 30

** Sample: calculator with hand-written lexer
